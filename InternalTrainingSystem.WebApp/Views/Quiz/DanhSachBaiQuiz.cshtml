@model List<InternalTrainingSystem.WebApp.Models.Quiz.QuizViewModel>
@using InternalTrainingSystem.WebApp.Constants
@{
    ViewData["Title"] = "Danh Sách Bài Kiểm Tra";
}

<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-12">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2><i class="fas fa-clipboard-check me-2 text-primary"></i>Danh Sách Bài Kiểm Tra</h2>
                    <p class="text-muted mb-0">
                        @if (!string.IsNullOrEmpty(ViewBag.CurrentSearch))
                        {
                            <span>Tìm thấy @ViewBag.FilteredCount kết quả cho "@ViewBag.CurrentSearch" trong tổng số @ViewBag.TotalQuizzes bài kiểm tra</span>
                        }
                        else
                        {
                            <span>Tổng cộng @ViewBag.TotalQuizzes bài kiểm tra (@ViewBag.CompletedCount đã hoàn thành)</span>
                        }
                    </p>
                </div>
                <div>
                    <a asp-action="TaoQuiz" class="btn btn-success btn-lg">
                        <i class="fas fa-plus me-2"></i>Tạo Bài Kiểm Tra
                    </a>
                </div>
            </div>

            <!-- Search -->
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title mb-3">
                        <i class="fas fa-search me-2"></i>Tìm Kiếm Bài Quiz
                    </h5>
                    <form method="get" class="row g-3">
                        <div class="col-md-10">
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-search"></i></span>
                                <input type="text" name="search" class="form-control" 
                                       placeholder="Tìm kiếm theo tên bài quiz, mô tả, chủ đề hoặc người tạo..." 
                                       value="@ViewBag.CurrentSearch">
                            </div>
                        </div>
                        <div class="col-md-2">
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-search me-1"></i>Tìm
                            </button>
                        </div>
                        @if (!string.IsNullOrEmpty(ViewBag.CurrentSearch))
                        {
                            <div class="col-12">
                                <a href="@Url.Action("DanhSachBaiQuiz")" class="btn btn-outline-secondary">
                                    <i class="fas fa-times me-1"></i>Xóa tìm kiếm
                                </a>
                            </div>
                        }
                    </form>
                </div>
            </div>

            <!-- Quiz Grid -->
            <div class="row">
                @if (Model != null && Model.Any())
                {
                    @foreach (var quiz in Model)
                    {
                        <div class="col-xl-3 col-lg-4 col-md-6 mb-4">
                            <div class="card quiz-card h-100 shadow-sm">
                                <div class="card-header bg-@quiz.GetSubjectColor() text-white">
                                    <h6 class="card-title mb-0">
                                        <i class="fas @quiz.GetSubjectIcon() me-2"></i>@quiz.Subject
                                    </h6>
                                </div>
                                <div class="card-body d-flex flex-column">
                                    <h5 class="card-title">@quiz.Title</h5>
                                    <p class="card-text text-muted flex-grow-1">@quiz.Description</p>
                                    
                                    <div class="quiz-info mb-3">
                                        <div class="row text-center">
                                            <div class="col-4">
                                                <small class="text-muted d-block">Thời gian</small>
                                                <strong>@quiz.TimeLimit phút</strong>
                                            </div>
                                            <div class="col-4">
                                                <small class="text-muted d-block">Câu hỏi</small>
                                                <strong>@quiz.QuestionCount</strong>
                                            </div>
                                            <div class="col-4">
                                                <small class="text-muted d-block">Lần thử</small>
                                                <strong>@quiz.AttemptCount</strong>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="quiz-badges mb-3">
                                        <span class="badge @quiz.GetStatusBadgeClass()">@quiz.Status</span>
                                    </div>

                                    @if (quiz.BestScore.HasValue)
                                    {
                                        <div class="progress mb-3" style="height: 8px;">
                                            <div class="progress-bar bg-success" role="progressbar" 
                                                 style="width: @quiz.BestScore%;" 
                                                 aria-valuenow="@quiz.BestScore" aria-valuemin="0" aria-valuemax="100">
                                            </div>
                                        </div>
                                        <small class="text-muted">Điểm cao nhất: @quiz.BestScore.Value.ToString("F1")%</small>
                                    }

                                    <div class="mt-auto">
                                        @if (quiz.IsCompleted)
                                        {
                                            <a asp-action="KetQua" asp-route-id="@quiz.Id" class="btn btn-outline-success w-100">
                                                <i class="fas fa-chart-line me-1"></i>Xem Kết Quả
                                            </a>
                                        }
                                        else
                                        {
                                            <a asp-action="LamQuiz" asp-route-id="@quiz.Id" class="btn btn-primary w-100">
                                                <i class="fas fa-play me-1"></i>Bắt Đầu Làm Bài
                                            </a>
                                        }
                                    </div>
                                </div>
                                <div class="card-footer text-muted">
                                    <small>
                                        <i class="fas fa-user me-1"></i>@quiz.CreatedBy
                                        <span class="float-end">
                                            <i class="fas fa-calendar me-1"></i>@quiz.CreatedDate.ToString("dd/MM/yyyy")
                                        </span>
                                    </small>
                                </div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="col-12">
                        <div class="text-center py-5">
                            <i class="fas fa-clipboard-check fa-3x text-muted mb-3"></i>
                            <h3 class="text-muted">Không tìm thấy bài kiểm tra nào</h3>
                            <p class="text-muted">Thử thay đổi bộ lọc hoặc tạo bài kiểm tra mới</p>
                        </div>
                    </div>
                }
            </div>

            <!-- Pagination -->
            @if (ViewBag.TotalPages > 1)
            {
                <nav aria-label="Quiz pagination">
                    <ul class="pagination justify-content-center">
                        @if (ViewBag.CurrentPage > 1)
                        {
                            <li class="page-item">
                                <a class="page-link" href="@Url.Action("DanhSachBaiQuiz", new { search = ViewBag.CurrentSearch, page = ViewBag.CurrentPage - 1 })">
                                    <i class="fas fa-chevron-left"></i>
                                </a>
                            </li>
                        }
                        
                        @for (int i = Math.Max(1, ViewBag.CurrentPage - 2); i <= Math.Min(ViewBag.TotalPages, ViewBag.CurrentPage + 2); i++)
                        {
                            <li class="page-item @(i == ViewBag.CurrentPage ? "active" : "")">
                                <a class="page-link" href="@Url.Action("DanhSachBaiQuiz", new { search = ViewBag.CurrentSearch, page = i })">@i</a>
                            </li>
                        }
                        
                        @if (ViewBag.CurrentPage < ViewBag.TotalPages)
                        {
                            <li class="page-item">
                                <a class="page-link" href="@Url.Action("DanhSachBaiQuiz", new { search = ViewBag.CurrentSearch, page = ViewBag.CurrentPage + 1 })">
                                    <i class="fas fa-chevron-right"></i>
                                </a>
                            </li>
                        }
                    </ul>
                </nav>
            }
        </div>
    </div>
</div>

<style>
    .quiz-card {
        transition: all 0.3s ease;
        border: none;
    }
    
    .quiz-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.15) !important;
    }
    
    .quiz-info {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 10px;
    }
    
    .badge-success { background-color: #28a745; }
    .badge-warning { background-color: #ffc107; color: #212529; }
    .badge-danger { background-color: #dc3545; }
    .badge-secondary { background-color: #6c757d; }
    .badge-info { background-color: #17a2b8; }
    .badge-primary { background-color: #007bff; }
    .badge-light { background-color: #f8f9fa; color: #212529; }
</style>

@section Scripts {
    <script>
        // Smooth transitions for cards
        $(document).ready(function() {
            $('.quiz-card').hover(
                function() {
                    $(this).addClass('shadow-lg').removeClass('shadow-sm');
                },
                function() {
                    $(this).addClass('shadow-sm').removeClass('shadow-lg');
                }
            );
        });
    </script>
}