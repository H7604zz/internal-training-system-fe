@model InternalTrainingSystem.WebApp.Models.DTOs.CourseDto
@using InternalTrainingSystem.WebApp.Constants
@using InternalTrainingSystem.WebApp.Extensions
@using InternalTrainingSystem.WebApp.Models.DTOs
@{
    ViewData["Title"] = $"Chi Tiết Khóa Học - {Model.CourseName}";
}

@section Styles {
    <link rel="stylesheet" href="~/css/khoa-hoc.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/course-content.css" asp-append-version="true" />
}

<div class="course-container">
    <div class="container-fluid">
        <!-- Header Section -->
        <div class="course-detail-header">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <div class="header-content">
                        <div class="d-flex align-items-center mb-2">
                            <h1 class="course-detail-title">@Model.CourseName</h1>
                            <span class="status-badge @(Model.IsActive ? "status-active" : "status-inactive") ms-3">
                                <i class="fas @(Model.IsActive ? "fa-check-circle" : "fa-pause-circle") me-1"></i>
                                @Model.StatusDisplay
                            </span>
                        </div>
                        <div class="course-meta-inline">
                            <span class="meta-item">
                                <i class="fas fa-tag"></i>
                                <span>@Model.CategoryName</span>
                            </span>
                            <span class="meta-item">
                                <i class="fas fa-clock"></i>
                                <span>@Model.DurationDisplay</span>
                            </span>
                            <span class="meta-item">
                                <i class="fas fa-code"></i>
                                <span>@Model.Code</span>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 text-md-end mt-3 mt-md-0">
                    <div class="action-buttons">
                        <a href="@Url.Action("ChinhSua", new { id = Model.CourseId })" class="btn btn-edit-main">
                            <i class="fas fa-edit me-2"></i>Chỉnh Sửa
                        </a>
                        <a href="@Url.Action("Index")" class="btn btn-back">
                            <i class="fas fa-arrow-left me-2"></i>Quay Lại
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Course Detail Content -->
        <div class="row">
            <!-- Main Info -->
            <div class="col-lg-8 mb-4">
                <div class="course-detail-card">
                    <h3 class="section-title">
                        <i class="fas fa-info-circle me-2"></i>Thông Tin Chi Tiết
                    </h3>
                    
                    <div class="detail-section">
                        <h4 class="subsection-title">
                            <i class="fas fa-align-left me-2"></i>Mô tả khóa học
                        </h4>
                        <div class="description-content">
                            @if (!string.IsNullOrEmpty(Model.Description))
                            {
                                <p>@Model.Description</p>
                            }
                            else
                            {
                                <p class="text-muted">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Chưa có mô tả chi tiết cho khóa học này. Vui lòng liên hệ với người quản lý để cập nhật thông tin.
                                </p>
                            }
                        </div>
                    </div>

                    <div class="detail-section">
                        <h4 class="subsection-title">
                            <i class="fas fa-info-circle me-2"></i>Thông tin cơ bản
                        </h4>
                        <div class="info-grid">
                            <div class="info-item">
                                <label><i class="fas fa-barcode me-1"></i>Mã khóa học:</label>
                                <span>@Model.Code</span>
                            </div>
                            <div class="info-item">
                                <label><i class="fas fa-folder me-1"></i>Danh mục:</label>
                                <span>@Model.CategoryName</span>
                            </div>
                            <div class="info-item">
                                <label><i class="fas fa-stopwatch me-1"></i>Thời lượng:</label>
                                <span>@Model.DurationDisplay</span>
                            </div>
                            <div class="info-item">
                                <label><i class="fas fa-layer-group me-1"></i>Cấp độ:</label>
                                <span class="level-badge @Model.Level.GetLevelBadgeClass()">
                                    @Model.Level.GetLevelDisplay()
                                </span>
                            </div>
                            <div class="info-item">
                                <label><i class="fas fa-globe me-1"></i>Hình thức:</label>
                                <span class="status-badge @(Model.IsOnline ? "status-online" : "status-offline")">
                                    @(Model.IsOnline ? "Trực tuyến" : "Trực tiếp")
                                </span>
                            </div>
                            <div class="info-item">
                                <label><i class="fas fa-exclamation-circle me-1"></i>Yêu cầu:</label>
                                <span class="status-badge @(Model.IsMandatory ? "status-mandatory" : "status-optional")">
                                    @(Model.IsMandatory ? "Bắt buộc" : "Tùy chọn")
                                </span>
                            </div>
                            @if (Model.Status == "Approved")
                            {
                                <div class="info-item">
                                    <label><i class="fas fa-toggle-on me-1"></i>Trạng thái:</label>
                                    <span class="status-badge @(Model.IsActive ? "status-active" : "status-inactive")">
                                        @Model.StatusDisplay
                                    </span>
                                </div>
                            }
                            <div class="info-item">
                                <label><i class="fas fa-clipboard-check me-1"></i>Phê duyệt:</label>
                                <span class="status-badge @(Model.Status == "Approved" ? "status-approved" : Model.Status == "Rejected" ? "status-rejected" : "status-pending")">
                                    @Model.ApprovalStatusDisplay
                                </span>
                            </div>
                            <div class="info-item">
                                <label><i class="fas fa-calendar-plus me-1"></i>Ngày tạo:</label>
                                <span>@(Model.CreatedDate.ToString("dd/MM/yyyy") ?? "Không xác định")</span>
                            </div>
                        </div>
                    </div>

                    @if (Model.Departments != null && Model.Departments.Any())
                    {
                        <div class="detail-section">
                            <h4 class="subsection-title">
                                <i class="fas fa-building me-2"></i>Phòng ban áp dụng
                            </h4>
                            <div class="departments-detail">
                                @foreach (var dept in Model.Departments)
                                {
                                    <div class="department-tag">
                                        <i class="fas fa-building me-1"></i>
                                        @dept.DepartmentName
                                    </div>
                                }
                            </div>
                        </div>
                    }

                    <!-- Course Content Section -->
                    <div class="detail-section">
                        <h4 class="subsection-title">
                            <i class="fas fa-book me-2"></i>Nội dung khóa học
                        </h4>
                        
                        @if (Model.Modules != null && Model.Modules.Any())
                        {
                            <div class="course-content">
                                @foreach (var module in Model.Modules.OrderBy(m => m.OrderIndex))
                                {
                                    var moduleIndex = Model.Modules.OrderBy(m => m.OrderIndex).ToList().IndexOf(module);
                                    var bgColorClass = moduleIndex % 3 == 0 ? "bg-primary" : moduleIndex % 3 == 1 ? "bg-success" : "bg-warning";
                                    var textColorClass = moduleIndex % 3 == 2 ? "text-dark" : "text-white";
                                    
                                    <div class="module-display mb-4">
                                        <div class="card">
                                            <div class="card-header @bgColorClass @textColorClass">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <h5 class="mb-0">
                                                        <i class="fas fa-folder me-2"></i>
                                                        Module @module.OrderIndex: @module.Title
                                                    </h5>
                                                    <span class="badge bg-light text-dark">
                                                        <i class="fas fa-play-circle me-1"></i>@module.Lessons.Count bài học
                                                    </span>
                                                </div>
                                                @if (!string.IsNullOrEmpty(module.Description))
                                                {
                                                    <small class="mt-2 d-block opacity-75">
                                                        @module.Description
                                                    </small>
                                                }
                                            </div>
                                            <div class="card-body">
                                                @if (module.Lessons != null && module.Lessons.Any())
                                                {
                                                    <div class="lessons-list">
                                                        @foreach (var lesson in module.Lessons.OrderBy(l => l.OrderIndex))
                                                        {
                                                            <div class="lesson-item">
                                                                <div class="lesson-header">
                                                                    <div class="lesson-info">
                                                                        <h6>Bài @lesson.OrderIndex: @lesson.Title</h6>
                                                                        <div class="lesson-meta">
                                                                            <span class="badge 
                                                                                @(lesson.Type == LessonType.Video ? "bg-danger" : 
                                                                                  lesson.Type == LessonType.Reading ? "bg-primary" : 
                                                                                  "bg-success")">
                                                                                <i class="fas @lesson.TypeIcon me-1"></i>
                                                                                @lesson.TypeDisplay
                                                                            </span>
                                                                            
                                                                            @if (lesson.Type == LessonType.Video && !string.IsNullOrEmpty(lesson.ContentUrl))
                                                                            {
                                                                                <a href="@lesson.ContentUrl" target="_blank" class="ms-2 text-decoration-none">
                                                                                    <i class="fas fa-external-link-alt me-1"></i>Xem video
                                                                                </a>
                                                                            }
                                                                            
                                                                            @if (lesson.Type == LessonType.Quiz && lesson.QuizId.HasValue)
                                                                            {
                                                                                <span class="ms-2 text-muted">
                                                                                    <i class="fas fa-clipboard-list me-1"></i>Quiz
                                                                                </span>
                                                                            }
                                                                        </div>
                                                                        
                                                                        @if (!string.IsNullOrEmpty(lesson.Description))
                                                                        {
                                                                            <p class="lesson-description mt-2 mb-0">
                                                                                @lesson.Description
                                                                            </p>
                                                                        }
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        }
                                                    </div>
                                                }
                                                else
                                                {
                                                    <p class="text-muted mb-0">
                                                        <i class="fas fa-info-circle me-2"></i>
                                                        Module này chưa có bài học nào.
                                                    </p>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        }
                        else
                        {
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                Khóa học này chưa có nội dung. Vui lòng cập nhật thêm modules và bài học.
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Side Info -->
            <div class="col-lg-4 mb-4">
                <!-- Quick Stats -->
                <div class="course-detail-card">
                    <h3 class="section-title">
                        <i class="fas fa-chart-bar me-2"></i>Thống Kê Khóa Học
                    </h3>
                    <div class="stats-list">
                        <div class="stat-item">
                            <div class="stat-label">
                                <span>
                                    <i class="fas fa-users"></i>
                                    Số học viên đã tham gia
                                </span>
                                <span class="stat-value">45</span>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">
                                <span>
                                    <i class="fas fa-calendar-alt"></i>
                                    Lớp học đang mở
                                </span>
                                <span class="stat-value">3</span>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">
                                <span>
                                    <i class="fas fa-star"></i>
                                    Đánh giá trung bình
                                </span>
                                <span class="stat-value">4.5/5</span>
                            </div>
                        </div>
                        
                    </div>
                </div>

                <!-- Course Actions -->
                <div class="course-detail-card">
                    <h3 class="section-title">
                        <i class="fas fa-cogs me-2"></i>Quản Lý Khóa Học
                    </h3>
                    <div class="action-list">
                        <a href="#" class="action-link">
                            <i class="fas fa-plus-circle"></i>
                            <span>Tạo lớp học mới từ khóa học này</span>
                        </a>
                        <a href="#" class="action-link">
                            <i class="fas fa-users"></i>
                            <span>Xem danh sách học viên đã đăng ký</span>
                        </a>
                        <a href="#" class="action-link">
                            <i class="fas fa-chart-line"></i>
                            <span>Xem báo cáo tiến độ học tập</span>
                        </a>
                        <a href="#" class="action-link">
                            <i class="fas fa-clipboard-list"></i>
                            <span>Quản lý bài kiểm tra và đánh giá</span>
                        </a>
                        <a href="#" class="action-link">
                            <i class="fas fa-download"></i>
                            <span>Xuất báo cáo chi tiết</span>
                        </a>
                    </div>
                </div>

                <!-- Course Information -->
                <div class="course-detail-card">
                    <h3 class="section-title">
                        <i class="fas fa-lightbulb me-2"></i>Thông Tin Hữu Ích
                    </h3>
                    <div class="action-list">
                        <div class="action-link" style="cursor: default; background: linear-gradient(135deg, #e8f5e8, #f0f8f0);">
                            <i class="fas fa-user-tie text-primary"></i>
                            <span>
                                <strong>Đối tượng:</strong><br>
                                <small class="text-muted">Nhân viên các phòng ban liên quan</small>
                            </span>
                        </div>
                        <div class="action-link" style="cursor: default; background: linear-gradient(135deg, #fff3cd, #fef9e7);">
                            <i class="fas fa-clock text-warning"></i>
                            <span>
                                <strong>Thời gian học:</strong><br>
                                <small class="text-muted">Linh hoạt theo lịch làm việc</small>
                            </span>
                        </div>
                        <div class="action-link" style="cursor: default; background: linear-gradient(135deg, #d1ecf1, #e8f4f8);">
                            <i class="fas fa-certificate text-info"></i>
                            <span>
                                <strong>Chứng chỉ:</strong><br>
                                <small class="text-muted">Cấp chứng chỉ hoàn thành</small>
                            </span>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>