@model InternalTrainingSystem.WebApp.Models.DTOs.CourseDto
@{
    ViewData["Title"] = "Thêm Khóa Học Mới";
}

@section Styles {
    <link rel="stylesheet" href="~/css/khoa-hoc.css" asp-append-version="true" />
}

<div class="course-container">
    <div class="container-fluid">
        <!-- Header Section -->
        <div class="form-header">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="form-title">
                        <i class="fas fa-plus-circle me-3"></i>Thêm Khóa Học Mới
                    </h1>
                    <p class="form-subtitle">Tạo mới khóa học đào tạo nội bộ</p>
                </div>
                <div class="col-md-4 text-md-end">
                    <a href="@Url.Action("Index")" class="btn btn-back">
                        <i class="fas fa-arrow-left me-2"></i>Quay Lại
                    </a>
                </div>
            </div>
        </div>

        <!-- Add Form -->
        <form method="post" asp-action="TaoMoi" class="course-edit-form" novalidate>
            @Html.AntiForgeryToken()

            <div class="row">
                <!-- Main Form -->
                <div class="col-lg-8 mb-4">
                    <div class="form-card">
                        <h3 class="form-section-title">
                            <i class="fas fa-info-circle me-2"></i>Thông Tin Cơ Bản
                        </h3>
                        
                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label asp-for="CourseName" class="form-label required">Tên khóa học</label>
                                <input asp-for="CourseName" class="form-control" placeholder="Nhập tên khóa học">
                                <span asp-validation-for="CourseName" class="text-danger"></span>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label asp-for="Code" class="form-label required">Mã khóa học</label>
                                <input asp-for="Code" class="form-control" placeholder="VD: IT-001">
                                <span asp-validation-for="Code" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Description" class="form-label">Mô tả khóa học</label>
                            <textarea asp-for="Description" class="form-control" rows="4" 
                                      placeholder="Nhập mô tả chi tiết về khóa học..."></textarea>
                            <span asp-validation-for="Description" class="text-danger"></span>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="Category" class="form-label required">Danh mục</label>
                                <select asp-for="Category" class="form-select">
                                    <option value="">Chọn danh mục</option>
                                    @if (ViewBag.Categories != null)
                                    {
                                        @foreach (dynamic category in ViewBag.Categories)
                                        {
                                            <option value="@category.Id">@category.Name</option>
                                        }
                                    }
                                </select>
                                <span asp-validation-for="Category" class="text-danger"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="Level" class="form-label required">Cấp độ</label>
                                <select asp-for="Level" class="form-select">
                                    <option value="">Chọn cấp độ</option>
                                    <option value="Cơ bản">Cơ bản</option>
                                    <option value="Trung cấp">Trung cấp</option>
                                    <option value="Nâng cao">Nâng cao</option>
                                </select>
                                <span asp-validation-for="Level" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="Duration" class="form-label required">Thời lượng (giờ)</label>
                                <input asp-for="Duration" type="number" class="form-control" min="1"
                                       placeholder="VD: 40" value="1">
                                <span asp-validation-for="Duration" class="text-danger"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Trạng thái</label>
                                <div class="form-check form-switch">
                                    <input asp-for="IsActive" class="form-check-input" type="checkbox" role="switch" checked>
                                    <label asp-for="IsActive" class="form-check-label">
                                        Khóa học đang hoạt động
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Department Selection -->
                    <div class="form-card">
                        <h3 class="form-section-title">
                            <i class="fas fa-building me-2"></i>Phòng Ban Áp Dụng
                        </h3>
                        <p class="form-help-text">Chọn các phòng ban mà khóa học này sẽ được áp dụng</p>
                        
                        <div class="departments-selection">
                            @if (ViewBag.Departments != null)
                            {
                                @foreach (var dept in ViewBag.Departments)
                                {
                                    <div class="form-check department-check">
                                        <input class="form-check-input" type="checkbox" 
                                               name="SelectedDepartmentIds" value="@dept.Id" 
                                               id="dept_@dept.Id">
                                        <label class="form-check-label" for="dept_@dept.Id">
                                            <i class="fas fa-building me-2"></i>
                                            @dept.Name
                                        </label>
                                    </div>
                                }
                            }
                        </div>
                    </div>

                    <!-- Course Content Section -->
                    <div class="form-card">
                        <h3 class="form-section-title">
                            <i class="fas fa-book me-2"></i>Nội Dung Khóa Học
                        </h3>
                        <p class="form-help-text">Tạo các module và bài học cho khóa học</p>

                        <!-- Modules Container -->
                        <div id="modules-container">
                            <!-- Module template will be added here -->
                        </div>

                        <button type="button" class="btn btn-outline-primary mt-3" id="add-module-btn">
                            <i class="fas fa-plus me-2"></i>Thêm Module
                        </button>
                    </div>
                </div>

                <!-- Side Panel -->
                <div class="col-lg-4 mb-4">
                    <!-- Form Actions -->
                    <div class="form-card">
                        <h3 class="form-section-title">
                            <i class="fas fa-save me-2"></i>Thao Tác
                        </h3>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-save">
                                <i class="fas fa-plus me-2"></i>Tạo Khóa Học
                            </button>
                            <a href="@Url.Action("Index")" class="btn btn-cancel">
                                <i class="fas fa-times me-2"></i>Hủy Bỏ
                            </a>
                        </div>

                    </div>

                    <!-- Form Help -->
                    <div class="form-card">
                        <h3 class="form-section-title">
                            <i class="fas fa-question-circle me-2"></i>Hướng Dẫn
                        </h3>
                        
                        <div class="help-list">
                            <div class="help-item">
                                <i class="fas fa-lightbulb"></i>
                                <span>Tên khóa học nên ngắn gọn và dễ hiểu</span>
                            </div>
                            <div class="help-item">
                                <i class="fas fa-lightbulb"></i>
                                <span>Mã khóa học nên theo chuẩn: ABC-123</span>
                            </div>
                            <div class="help-item">
                                <i class="fas fa-lightbulb"></i>
                                <span>Chọn cấp độ phù hợp với nội dung khóa học</span>
                            </div>
                            <div class="help-item">
                                <i class="fas fa-lightbulb"></i>
                                <span>Thời lượng tính bằng giờ học lý thuyết</span>
                            </div>
                            <div class="help-item">
                                <i class="fas fa-lightbulb"></i>
                                <span>Chọn ít nhất 1 phòng ban để áp dụng khóa học</span>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Templates -->
                    <div class="form-card">
                        <h3 class="form-section-title">
                            <i class="fas fa-templates me-2"></i>Mẫu Nhanh
                        </h3>
                        
                        <div class="template-list">
                            <button type="button" class="template-btn" data-template="it">
                                <i class="fas fa-laptop-code"></i>
                                <span>Khóa học IT</span>
                            </button>
                            <button type="button" class="template-btn" data-template="soft-skills">
                                <i class="fas fa-users"></i>
                                <span>Kỹ năng mềm</span>
                            </button>
                            <button type="button" class="template-btn" data-template="management">
                                <i class="fas fa-chart-line"></i>
                                <span>Quản lý</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </form>

        <!-- Hidden Templates -->
        <div id="module-template" style="display: none;">
            <div class="module-item mb-4" data-module-index="">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-folder me-2"></i>Module <span class="module-number"></span>
                        </h5>
                        <div>
                            <button type="button" class="btn btn-sm btn-outline-secondary move-up-module" title="Di chuyển lên">
                                <i class="fas fa-arrow-up"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-secondary move-down-module" title="Di chuyển xuống">
                                <i class="fas fa-arrow-down"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-danger remove-module" title="Xóa module">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label required">Tên Module</label>
                                <input type="text" name="Modules[].ModuleName" class="form-control" placeholder="Nhập tên module">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label required">Thứ tự</label>
                                <input type="number" name="Modules[].Order" class="form-control module-order" min="1" readonly>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Mô tả Module</label>
                            <textarea name="Modules[].Description" class="form-control" rows="2" placeholder="Nhập mô tả module..."></textarea>
                        </div>

                        <!-- Lessons Section -->
                        <div class="lessons-section">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6><i class="fas fa-play-circle me-2"></i>Bài Học</h6>
                                <button type="button" class="btn btn-sm btn-outline-primary add-lesson-btn">
                                    <i class="fas fa-plus me-1"></i>Thêm Bài Học
                                </button>
                            </div>
                            <div class="lessons-container">
                                <!-- Lessons will be added here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="lesson-template" style="display: none;">
            <div class="lesson-item mb-3" data-lesson-index="">
                <div class="card border-start border-primary border-3">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-play me-2"></i>Bài học <span class="lesson-number"></span>
                            </h6>
                            <div>
                                <button type="button" class="btn btn-sm btn-outline-secondary move-up-lesson" title="Di chuyển lên">
                                    <i class="fas fa-arrow-up"></i>
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-secondary move-down-lesson" title="Di chuyển xuống">
                                    <i class="fas fa-arrow-down"></i>
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-danger remove-lesson" title="Xóa bài học">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-8">
                                <label class="form-label required">Tên Bài Học</label>
                                <input type="text" name="Modules[].Lessons[].LessonName" class="form-control" placeholder="Nhập tên bài học">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label required">Thứ tự</label>
                                <input type="number" name="Modules[].Lessons[].Order" class="form-control lesson-order" min="1" readonly>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Nội dung học</label>
                            <div class="content-upload-area">
                                <div class="upload-tabs mb-3">
                                    <div class="btn-group" role="group">
                                        <input type="radio" class="btn-check content-type" name="content-type-" id="video-" value="video">
                                        <label class="btn btn-outline-primary" for="video-">
                                            <i class="fas fa-video me-1"></i>Video
                                        </label>

                                        <input type="radio" class="btn-check content-type" name="content-type-" id="pdf-" value="pdf">
                                        <label class="btn btn-outline-primary" for="pdf-">
                                            <i class="fas fa-file-pdf me-1"></i>PDF
                                        </label>

                                        <input type="radio" class="btn-check content-type" name="content-type-" id="image-" value="image">
                                        <label class="btn btn-outline-primary" for="image-">
                                            <i class="fas fa-image me-1"></i>Hình ảnh
                                        </label>

                                        <input type="radio" class="btn-check content-type" name="content-type-" id="document-" value="document">
                                        <label class="btn btn-outline-primary" for="document-">
                                            <i class="fas fa-file-alt me-1"></i>Tài liệu
                                        </label>
                                    </div>
                                </div>

                                <div class="file-upload-container">
                                    <div class="file-upload-area">
                                        <input type="file" name="Modules[].Lessons[].ContentFile" class="form-control content-file-input" accept="">
                                        <div class="upload-placeholder text-center p-4">
                                            <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-2"></i>
                                            <p class="text-muted mb-0">Chọn loại nội dung và tải lên tệp</p>
                                            <small class="text-muted">Hỗ trợ: Video (MP4), PDF, Hình ảnh (JPG, PNG), Tài liệu (DOCX, PPTX)</small>
                                        </div>
                                    </div>
                                    <div class="file-info mt-2" style="display: none;">
                                        <div class="alert alert-info">
                                            <i class="fas fa-file me-2"></i>
                                            <span class="file-name"></span>
                                            <span class="file-size text-muted ms-2"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let moduleIndex = 0;

            const formElements = {
                name: document.getElementById('CourseName'),
                code: document.getElementById('Code'),
                level: document.getElementById('Level'),
                duration: document.getElementById('Duration')
            };

            // Auto-generate course code from name
            if (formElements.name && formElements.code) {
                formElements.name.addEventListener('blur', function() {
                    if (!formElements.code.value && this.value) {
                        const words = this.value.split(' ').slice(0, 2);
                        const code = words.map(word => word.charAt(0).toUpperCase()).join('') + 
                                   '-' + String(Math.floor(Math.random() * 100) + 1).padStart(3, '0');
                        formElements.code.value = code;
                    }
                });
            }

            // Module and Lesson Management
            const modulesContainer = document.getElementById('modules-container');
            const addModuleBtn = document.getElementById('add-module-btn');
            const moduleTemplate = document.getElementById('module-template');
            const lessonTemplate = document.getElementById('lesson-template');

            // Add Module
            addModuleBtn.addEventListener('click', function() {
                addModule();
            });

            function addModule() {
                const moduleHtml = moduleTemplate.innerHTML;
                const moduleDiv = document.createElement('div');
                moduleDiv.innerHTML = moduleHtml;
                const moduleItem = moduleDiv.firstElementChild;
                
                moduleIndex++;
                moduleItem.setAttribute('data-module-index', moduleIndex - 1);
                
                // Update module number and form names
                updateModuleIndexes(moduleItem, moduleIndex - 1);
                
                modulesContainer.appendChild(moduleItem);
                
                // Add event listeners
                addModuleEventListeners(moduleItem);
                
                // Update all module orders
                updateModuleOrders();
            }

            function addModuleEventListeners(moduleItem) {
                // Remove module
                moduleItem.querySelector('.remove-module').addEventListener('click', function() {
                    moduleItem.remove();
                    updateModuleOrders();
                });

                // Move module up/down
                moduleItem.querySelector('.move-up-module').addEventListener('click', function() {
                    const prev = moduleItem.previousElementSibling;
                    if (prev) {
                        modulesContainer.insertBefore(moduleItem, prev);
                        updateModuleOrders();
                    }
                });

                moduleItem.querySelector('.move-down-module').addEventListener('click', function() {
                    const next = moduleItem.nextElementSibling;
                    if (next) {
                        modulesContainer.insertBefore(next, moduleItem);
                        updateModuleOrders();
                    }
                });

                // Add lesson
                moduleItem.querySelector('.add-lesson-btn').addEventListener('click', function() {
                    addLesson(moduleItem);
                });
            }

            function addLesson(moduleItem) {
                const lessonHtml = lessonTemplate.innerHTML;
                const lessonDiv = document.createElement('div');
                lessonDiv.innerHTML = lessonHtml;
                const lessonItem = lessonDiv.firstElementChild;
                
                const lessonsContainer = moduleItem.querySelector('.lessons-container');
                const moduleIndex = moduleItem.getAttribute('data-module-index');
                const lessonIndex = lessonsContainer.children.length;
                
                lessonItem.setAttribute('data-lesson-index', lessonIndex);
                
                // Update lesson form names and IDs
                updateLessonIndexes(lessonItem, moduleIndex, lessonIndex);
                
                lessonsContainer.appendChild(lessonItem);
                
                // Add event listeners
                addLessonEventListeners(lessonItem, moduleItem);
                
                // Update lesson orders in this module
                updateLessonOrders(moduleItem);
            }

            function addLessonEventListeners(lessonItem, moduleItem) {
                const lessonsContainer = moduleItem.querySelector('.lessons-container');

                // Remove lesson
                lessonItem.querySelector('.remove-lesson').addEventListener('click', function() {
                    lessonItem.remove();
                    updateLessonOrders(moduleItem);
                });

                // Move lesson up/down
                lessonItem.querySelector('.move-up-lesson').addEventListener('click', function() {
                    const prev = lessonItem.previousElementSibling;
                    if (prev) {
                        lessonsContainer.insertBefore(lessonItem, prev);
                        updateLessonOrders(moduleItem);
                    }
                });

                lessonItem.querySelector('.move-down-lesson').addEventListener('click', function() {
                    const next = lessonItem.nextElementSibling;
                    if (next) {
                        lessonsContainer.insertBefore(next, lessonItem);
                        updateLessonOrders(moduleItem);
                    }
                });

                // Content type change
                const contentTypeInputs = lessonItem.querySelectorAll('.content-type');
                const fileInput = lessonItem.querySelector('.content-file-input');
                
                contentTypeInputs.forEach(input => {
                    input.addEventListener('change', function() {
                        updateFileInputAccept(lessonItem, this.value);
                    });
                });

                // File upload
                fileInput.addEventListener('change', function() {
                    handleFileUpload(lessonItem, this);
                });
            }

            function updateModuleIndexes(moduleItem, index) {
                // Update module number display
                moduleItem.querySelector('.module-number').textContent = index + 1;
                
                // Update form field names
                const inputs = moduleItem.querySelectorAll('input[name^="Modules["], textarea[name^="Modules["]');
                inputs.forEach(input => {
                    const name = input.getAttribute('name');
                    const newName = name.replace(/Modules\[\d*\]/, `Modules[${index}]`);
                    input.setAttribute('name', newName);
                });

                // Update module order value
                moduleItem.querySelector('.module-order').value = index + 1;
            }

            function updateLessonIndexes(lessonItem, moduleIndex, lessonIndex) {
                // Update lesson number display
                lessonItem.querySelector('.lesson-number').textContent = lessonIndex + 1;
                
                // Update form field names and IDs
                const inputs = lessonItem.querySelectorAll('input, textarea');
                inputs.forEach(input => {
                    const name = input.getAttribute('name');
                    if (name && name.includes('Modules[].Lessons[]')) {
                        const newName = name.replace('Modules[].Lessons[]', `Modules[${moduleIndex}].Lessons[${lessonIndex}]`);
                        input.setAttribute('name', newName);
                    }

                    const id = input.getAttribute('id');
                    if (id && (id.includes('-') && id.endsWith('-'))) {
                        const newId = id.replace('-', `-${moduleIndex}-${lessonIndex}-`);
                        input.setAttribute('id', newId);
                        
                        // Update corresponding label
                        const label = lessonItem.querySelector(`label[for="${id}"]`);
                        if (label) {
                            label.setAttribute('for', newId);
                        }
                    }

                    const radioName = input.getAttribute('name');
                    if (radioName && radioName.includes('content-type-')) {
                        const newRadioName = `content-type-${moduleIndex}-${lessonIndex}`;
                        input.setAttribute('name', newRadioName);
                    }
                });

                // Update lesson order value
                lessonItem.querySelector('.lesson-order').value = lessonIndex + 1;
            }

            function updateModuleOrders() {
                const moduleItems = modulesContainer.querySelectorAll('.module-item');
                moduleItems.forEach((moduleItem, index) => {
                    moduleItem.setAttribute('data-module-index', index);
                    updateModuleIndexes(moduleItem, index);
                    
                    // Update all lessons in this module
                    const lessonItems = moduleItem.querySelectorAll('.lesson-item');
                    lessonItems.forEach((lessonItem, lessonIndex) => {
                        updateLessonIndexes(lessonItem, index, lessonIndex);
                    });
                });
            }

            function updateLessonOrders(moduleItem) {
                const lessonItems = moduleItem.querySelectorAll('.lesson-item');
                const moduleIndex = moduleItem.getAttribute('data-module-index');
                
                lessonItems.forEach((lessonItem, index) => {
                    lessonItem.setAttribute('data-lesson-index', index);
                    updateLessonIndexes(lessonItem, moduleIndex, index);
                });
            }

            function updateFileInputAccept(lessonItem, contentType) {
                const fileInput = lessonItem.querySelector('.content-file-input');
                const acceptTypes = {
                    'video': '.mp4,.avi,.mov,.wmv',
                    'pdf': '.pdf',
                    'image': '.jpg,.jpeg,.png,.gif,.bmp',
                    'document': '.doc,.docx,.ppt,.pptx,.txt'
                };
                
                fileInput.setAttribute('accept', acceptTypes[contentType] || '');
            }

            function handleFileUpload(lessonItem, fileInput) {
                const fileInfo = lessonItem.querySelector('.file-info');
                const fileName = lessonItem.querySelector('.file-name');
                const fileSize = lessonItem.querySelector('.file-size');
                
                if (fileInput.files && fileInput.files[0]) {
                    const file = fileInput.files[0];
                    fileName.textContent = file.name;
                    fileSize.textContent = `(${formatFileSize(file.size)})`;
                    fileInfo.style.display = 'block';
                } else {
                    fileInfo.style.display = 'none';
                }
            }

            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }

            // Template buttons
            const templateButtons = document.querySelectorAll('.template-btn');
            templateButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const template = this.dataset.template;
                    applyTemplate(template);
                });
            });

            function applyTemplate(template) {
                const templates = {
                    'it': {
                        name: 'Khóa học Lập trình Web',
                        description: 'Khóa học về phát triển ứng dụng web hiện đại với các công nghệ mới nhất',
                        level: 'Trung cấp',
                        duration: 40
                    },
                    'soft-skills': {
                        name: 'Kỹ năng Giao tiếp hiệu quả',
                        description: 'Phát triển kỹ năng giao tiếp và làm việc nhóm trong môi trường doanh nghiệp',
                        level: 'Cơ bản',
                        duration: 16
                    },
                    'management': {
                        name: 'Quản lý Dự án cơ bản',
                        description: 'Tìm hiểu các phương pháp quản lý dự án hiệu quả và công cụ hỗ trợ',
                        level: 'Trung cấp',
                        duration: 24
                    }
                };

                const templateData = templates[template];
                if (templateData) {
                    if (formElements.name) formElements.name.value = templateData.name;
                    
                    const descriptionField = document.getElementById('Description');
                    if (descriptionField) descriptionField.value = templateData.description;
                    
                    if (formElements.level) formElements.level.value = templateData.level;
                    if (formElements.duration) formElements.duration.value = templateData.duration;

                    // Generate code
                    if (formElements.code) {
                        const words = templateData.name.split(' ').slice(0, 2);
                        const code = words.map(word => word.charAt(0).toUpperCase()).join('') + 
                                   '-' + String(Math.floor(Math.random() * 100) + 1).padStart(3, '0');
                        formElements.code.value = code;
                    }
                }
            }

            // Department selection counter
            const departmentCheckboxes = document.querySelectorAll('input[name="SelectedDepartmentIds"]');
            const updateCounter = () => {
                const selected = document.querySelectorAll('input[name="SelectedDepartmentIds"]:checked').length;
                console.log(`Selected departments: ${selected}`);
            };
            
            departmentCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', updateCounter);
            });
        });
    </script>
}