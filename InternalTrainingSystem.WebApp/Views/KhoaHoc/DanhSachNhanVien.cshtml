@model List<InternalTrainingSystem.WebApp.Models.DTOs.EligibleStaffDto>
@using InternalTrainingSystem.WebApp.Constants
@using InternalTrainingSystem.WebApp.Extensions
@{
    ViewData["Title"] = "Danh Sách Nhân Viên Khóa Học";
    var course = ViewBag.Course as InternalTrainingSystem.WebApp.Models.DTOs.CourseDto;
}

@section Styles {
    <link rel="stylesheet" href="~/css/khoa-hoc.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/danh-sach-nhan-vien.css" asp-append-version="true" />
}

<div class="employee-list-container">
    <div class="container-fluid">
        <!-- Header -->
        <div class="employee-list-header">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <h1 class="employee-list-title">
                            <i class="fas fa-users me-3"></i>Danh Sách Nhân Viên Khóa Học
                        </h1>

                        @if (course != null)
                        {
                            <div class="course-info">
                                <h4><i class="fas fa-graduation-cap me-2"></i>@course.CourseName</h4>
                                <p class="mb-2"><strong>Mã khóa học:</strong> @course.Code</p>
                                <p class="mb-0"><strong>Mô tả:</strong> @course.Description</p>
                            </div>
                        }

                        <div class="stats-row">
                            <div class="stat-item">
                                <div class="stat-number">@ViewBag.TotalEmployees</div>
                                <div class="stat-label">Tổng nhân viên</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">@ViewBag.EnrolledCount</div>
                                <div class="stat-label">Đồng ý tham gia</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">@ViewBag.NotEnrolledCount</div>
                                <div class="stat-label">Chưa tham gia</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search & Filter -->
        <div class="search-filter-card">
            <h5 class="mb-3">
                <i class="fas fa-search me-2"></i>Tìm Kiếm & Lọc
            </h5>
            <form method="get" class="search-form">
                <input type="hidden" name="id" value="@ViewBag.CourseId" />
                <div class="row g-3">
                    <div class="col-lg-4 col-md-6">
                        <div class="form-group">
                            <label class="form-label">Mã NV/Tên/Email</label>
                            <input type="text" class="form-control" name="employeeId" 
                                   value="@ViewBag.EmployeeId" placeholder="Nhập mã nhân viên, tên hoặc email...">
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-6">
                        <div class="form-group">
                            <label class="form-label">Trạng thái</label>
                            <select class="form-select" name="status">
                                <option value="">Tất cả trạng thái</option>
                                <option value="@EmployeeStatus.NotEnrolled" selected="@(ViewBag.Status == EmployeeStatus.NotEnrolled)">@EmployeeStatus.GetDisplayText(EmployeeStatus.NotEnrolled)</option>
                                <option value="@EmployeeStatus.Enrolled" selected="@(ViewBag.Status == EmployeeStatus.Enrolled)">@EmployeeStatus.GetDisplayText(EmployeeStatus.Enrolled)</option>
                                <option value="@EmployeeStatus.InProgress" selected="@(ViewBag.Status == EmployeeStatus.InProgress)">@EmployeeStatus.GetDisplayText(EmployeeStatus.InProgress)</option>
                                <option value="@EmployeeStatus.Completed" selected="@(ViewBag.Status == EmployeeStatus.Completed)">@EmployeeStatus.GetDisplayText(EmployeeStatus.Completed)</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-12">
                        <div class="form-group">
                            <label class="form-label d-block">&nbsp;</label>
                            <div class="search-buttons">
                                <button type="submit" class="btn-search">
                                    <i class="fas fa-search me-1"></i>Tìm kiếm
                                </button>
                                <a href="@Url.Action("DanhSachNhanVien", "KhoaHoc", new { id = ViewBag.CourseId })" class="btn-reset">
                                    <i class="fas fa-undo me-1"></i>Reset
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Employee List -->
        <div class="employees-list">
            @if (Model != null && Model.Any())
            {
                @foreach (var employee in Model)
                {
                    <div class="employee-card" data-status="@employee.Status.ToLower()">
                        <div class="employee-header-card">
                            <div class="employee-info">
                                <div class="employee-avatar">
                                    @(employee.FullName.Split(' ').LastOrDefault()?.FirstOrDefault().ToString().ToUpper())
                                </div>
                                <div class="employee-details">
                                    <h5>@employee.FullName</h5>
                                    <div class="employee-meta">
                                        <i class="fas fa-id-card me-1"></i>Mã NV: @employee.EmployeeId
                                    </div>
                                    <div class="employee-meta">
                                        <i class="fas fa-building me-1"></i>@employee.Department
                                    </div>
                                    <div class="employee-meta">
                                        <i class="fas fa-user-tie me-1"></i>@employee.Position
                                    </div>
                                </div>
                                <div class="response-status">
                                    <span class="status-badge @employee.StatusBadgeClass">
                                        @employee.StatusText
                                    </span>
                                </div>
                            </div>
                        </div>

                        @if (!string.IsNullOrEmpty(employee.Reason) || !string.IsNullOrEmpty(employee.Email))
                        {
                            <div class="employee-body">
                                @if (!string.IsNullOrEmpty(employee.Reason))
                                {
                                    <div class="employee-note">
                                        <i class="fas fa-comment-alt me-2"></i>
                                        <strong>Ghi chú:</strong> @employee.Reason
                                    </div>
                                }

                                <div class="d-flex justify-content-between align-items-center">
                                    @if (!string.IsNullOrEmpty(employee.Email))
                                    {
                                        <div class="contact-info">
                                            <i class="fas fa-envelope me-1"></i>
                                            <span>@employee.Email</span>
                                        </div>
                                    }
                                </div>
                            </div>
                        }
                    </div>
                }
            }
            else
            {
                <div class="empty-state">
                    <i class="fas fa-users-slash"></i>
                    <h3>Không tìm thấy nhân viên nào</h3>
                    <p>Không có nhân viên nào phù hợp với bộ lọc hiện tại.</p>
                </div>
            }
        </div>

        <!-- Pagination -->
        @if (ViewBag.TotalPages > 1)
        {
            var paginationModel = new InternalTrainingSystem.WebApp.Models.ViewModels.PaginationViewModel
            {
                CurrentPage = ViewBag.CurrentPage,
                TotalPages = ViewBag.TotalPages,
                PageSize = ViewBag.PageSize,
                TotalItems = ViewBag.TotalItems,
                ActionName = "DanhSachNhanVien",
                ControllerName = "KhoaHoc",
                RouteValues = new Dictionary<string, object>
                {
                    { "id", ViewBag.CourseId },
                    { "employeeId", ViewBag.EmployeeId ?? "" },
                    { "status", ViewBag.Status ?? "" }
                }
            };
            
            @await Html.PartialAsync("_Pagination", paginationModel)
        }
    </div>
</div>
